/*
 * Copyright(c) OnePoint Software GmbH 2007. All Rights Reserved.
 */
package onepoint.project.test;

import onepoint.log.XLog;
import onepoint.log.XLogFactory;
import onepoint.project.OpInitializer;
import onepoint.project.OpInitializerFactory;
import onepoint.project.util.OpEnvironmentManager;
import onepoint.project.util.OpProjectConstants;
import onepoint.resource.XLocaleManager;
import onepoint.resource.XLocaleMap;
import onepoint.resource.XLocaleMapLoader;
import onepoint.resource.XResourceBroker;

import java.io.File;
import java.net.URISyntaxException;
import java.sql.SQLException;

/**
 * This is the super class for all test classes used into OnePoint project.
 *
 * @author calin.pavel
 */
public class OpBaseOpenTestCase extends OpBaseTestCase {
   private static final XLog logger = XLogFactory.getServerLogger(OpBaseOpenTestCase.class);


   // Initialize application
   static {
      // Now start application initialization.
      try {
         logger.debug("Static set up block for all test cases");
         File path = new File(OpBaseOpenTestCase.class.getResource("OpBaseOpenTestCase.class").toURI());
         path = path.getParentFile();
         OpEnvironmentManager.setOnePointHome(path.getPath());
         XResourceBroker.setResourcePath(OpTestDataFactory.RESOURCE_PATH);
         XLocaleMap locale_map = new XLocaleMapLoader().loadLocaleMap(OpTestDataFactory.LOCALES_OLM_XML);
         XLocaleManager.setLocaleMap(locale_map);

         // initialize factory
         OpInitializerFactory factory = OpInitializerFactory.getInstance();
         factory.setInitializer(OpInitializer.class);

         OpInitializer initializer = factory.getInitializer();
         initializer.init(OpProjectConstants.OPEN_EDITION_CODE);

         //make sure we have a clean schema
         initializer.resetDbSchema();
         logger.debug("Application initialization end.");
      }
      catch (SQLException e) {
         logger.error("Cannot initialize tests because:" + e.getMessage(), e);
         //evil...
         System.exit(0);
      }
      catch (URISyntaxException e) {
         e.printStackTrace();
      }
   }

   /**
    * Creates a new instance of test case.
    */
   public OpBaseOpenTestCase() {
   }

   /**
    * Creates a new instance of test case.
    *
    * @param name test case name
    */
   public OpBaseOpenTestCase(String name) {
      super(name);
   }


}
